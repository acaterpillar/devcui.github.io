<!doctype html><html lang=cn dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Prometheus Rules | 神奇宝贝大师的旅行日记</title>
<meta name=keywords content="prometheus">
<meta name=description content="Desc Text.">
<meta name=author content="cui">
<link rel=canonical href=https://canonical.url/to/page>
<meta name=google-site-verification content="blog">
<meta name=yandex-verification content="blog">
<meta name=msvalidate.01 content="blog">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<link rel=preload href=/images/favicon.png as=image>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://eiyouhe.com/images/favicon.png>
<link rel=icon type=image/png sizes=16x16 href=https://eiyouhe.com/images/favicon.png>
<link rel=icon type=image/png sizes=32x32 href=https://eiyouhe.com/images/favicon.png>
<link rel=apple-touch-icon href=https://eiyouhe.com/images/favicon.png>
<link rel=mask-icon href=https://eiyouhe.com/images/favicon.png>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-213464061-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Prometheus Rules">
<meta property="og:description" content="Desc Text.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://eiyouhe.com/posts/prometheus/prometheus-rules/"><meta property="og:image" content="https://eiyouhe.com/images/head.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-05T11:30:03+00:00">
<meta property="article:modified_time" content="2021-12-05T11:30:03+00:00"><meta property="og:site_name" content="神奇宝贝大师的旅行日记">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://eiyouhe.com/images/head.png">
<meta name=twitter:title content="Prometheus Rules">
<meta name=twitter:description content="Desc Text.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://eiyouhe.com/posts/"},{"@type":"ListItem","position":3,"name":"Prometheus Rules","item":"https://eiyouhe.com/posts/prometheus/prometheus-rules/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Prometheus Rules","name":"Prometheus Rules","description":"Desc Text.","keywords":["prometheus"],"articleBody":"1.Two types of rules Prometheus supports two types of rules .whitch may be configured and then evaluated at regular intervals: Recording rules and Alerting rules.\n2.Recording rules 1.Recording rules allow you to precompute frequently needed or computationally expensive expressions and save their result as a new set of time series.\n2.Be mutch faster than executing the origin expression every time it’s need.\n3.Rules within a group run sequentially at a regular interval.\nthe syntax of a rule file following\n1 2  groups: [ -  ]   the rule group following\n1 2 3 4  name:  [ interval:  | default = global.evaluation_interval ] rules: [ -  ... ]   the recording rule following\n1 2 3 4  record:  expr:  labels: [ :  ]   the alerting rule following\n1 2 3 4 5 6 7  alert:  expr:  [ for:  | default = 0s ] labels: [ :  ] annotations: [ :  ]   3.Alerting rules 1.Alerting rules allow you to define some alert conditions that used Prometheus expression language and to send notifaction about firing alerts to an external service.\nan example of alerting config would like this\n1 2 3 4 5 6 7 8 9 10  groups: - name: example rules: - alert: HighRequestLatency expr: job:request_latency_seconds:mean5m{job=\"myjob\"}  0.5 for: 10m labels: severity: page annotations: summary: High request latency   and a template description and annotation would like this\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  groups: - name: example rules: # Alert for any instance that is unreachable for 5 minutes. - alert: InstanceDown expr: up == 0 for: 5m labels: severity: page annotations: summary: \"Instance {{ $labels.instance }} down\" description: \"{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes.\" # Alert for any instance that has a median request latency 1s. - alert: APIHighRequestLatency expr: api_http_request_latencies_second{quantile=\"0.5\"}  1 for: 10m annotations: summary: \"High request latency on {{ $labels.instance }}\" description: \"{{ $labels.instance }} has a median request latency above 1s (current value: {{ $value }}s)\"   3.1 Template 1.Prometheus support templating in annotations and labels of alerts.\n2.Some functions such as iterate over data,use conditionals,format data.\n3.The prometheus template language is based on the Go Template.\n3.1.1 Template examples Iteration\n1 2 3  {{ range query \"up\" }} {{ .Labels.instance }} {{ .Value }} {{ end }}   Display one value\n1 2 3  {{ with query \"some_metric{instance='someinstance'}\" }} {{ . | first | value | humanize }} {{ end }}   Use console url param\n1 2 3  {{ with printf \"node_memory_MemTotal{job='node',instance='%s'}\" .Params.instance | query }} {{ . | first | value | humanize1024 }}B {{ end }}   That’s the meaning of: http://xxx.html?instance=127.0.0.1 then the .Params.instance will evaluate to 127.0.0.1\nAdvanced iteration\n1 2 3 4 5 6 7 8 9 10 11 12   {{ range printf \"node_network_receive_bytes{job='node',instance='%s',device!='lo'}\" .Params.instance | query | sortByLabel \"device\"}} {{ .Labels.device }}  Received {{ with printf \"rate(node_network_receive_bytes{job='node',instance='%s',device='%s'}[5m])\" .Labels.instance .Labels.device | query }}{{ . | first | value | humanize }}B/s{{end}}   Transmitted {{ with printf \"rate(node_network_transmit_bytes{job='node',instance='%s',device='%s'}[5m])\" .Labels.instance .Labels.device | query }}{{ . | first | value | humanize }}B/s{{end}} {{ end }}    define reusable tempalte\n1 2 3 4 5  {{define \"myMultiArgTemplate\"}} First argument: {{.arg0}} Second argument: {{.arg1}} {{end}} {{template \"myMultiArgTemplate\" (args 1 2)}}   3.1.2 Template reference go template https://golang.org/pkg/text/template/#hdr-Functions\nQueries    Name Arguments Returns Notes     query query string []sample Queries the database, does not support returning range vectors.   first []sample sample Equivalent to index a 0   label label, sample string Equivalent to index sample.Labels label   value sample float64 Equivalent to sample.Value   sortByLabel label, []samples []sample Sorts the samples by the given label. Is stable.    first, label and value are intended to make query results easily usable in pipelines.\nNumbers    Name Arguments Returns Notes     humanize number string Converts a number to a more readable format, using metric prefixes.   humanize1024 number string Like humanize, but uses 1024 as the base rather than 1000.   humanizeDuration number string Converts a duration in seconds to a more readable format.   humanizePercentage number string Converts a ratio value to a fraction of 100.   humanizeTimestamp number string Converts a Unix timestamp in seconds to a more readable format.    Humanizing functions are intended to produce reasonable output for consumption by humans, and are not guaranteed to return the same results between Prometheus versions.\nStrings    Name Arguments Returns Notes     title string string strings.Title, capitalises first character of each word.   toUpper string string strings.ToUpper, converts all characters to upper case.   toLower string string strings.ToLower, converts all characters to lower case.   match pattern, text boolean regexp.MatchString Tests for a unanchored regexp match.   reReplaceAll pattern, replacement, text string Regexp.ReplaceAllString Regexp substitution, unanchored.   graphLink expr string Returns path to graph view in the expression browser for the expression.   tableLink expr string Returns path to tabular (“Table”) view in the expression browser for the expression.    Others    Name Arguments Returns Notes     args []interface{} map[string]interface{} This converts a list of objects to a map with keys arg0, arg1 etc. This is intended to allow multiple arguments to be passed to templates.   tmpl string, []interface{} nothing Like the built-in template, but allows non-literals as the template name. Note that the result is assumed to be safe, and will not be auto-escaped. Only available in consoles.   safeHtml string string Marks string as HTML not requiring auto-escaping.    4.PromeQL 4.1 operators complute + - * / % ^\ncompare binary  == != = \nLogical set binary  and , or ,unless\nVector Matching one to one like this\n1  method:http_requests:rate5m{method=\"get\"}   1 2   ignoring()  on()   many to one and one to many like this\n1  method_code:http_errors:rate5m / ignoring(code) group_left method:http_requests:rate5m   1 2 3 4   ignoring() group_left()  ignoring() group_right()  on() group_left()  on() group_right()   Aggreation operators  sum (calculate sum over dimensions) min (select minimum over dimensions) max (select maximum over dimensions) avg (calculate the average over dimensions) group (all values in the resulting vector are 1) stddev (calculate population standard deviation over dimensions) stdvar (calculate population standard variance over dimensions) count (count number of elements in the vector) count_values (count number of elements with the same value) bottomk (smallest k elements by sample value) topk (largest k elements by sample value) quantile (calculate φ-quantile (0 ≤ φ ≤ 1) over dimensions)  parameter is only required for count_values, quantile, topk and bottomk.\nWithout remove the listed labels from the result vector\nBy does the opposite and drops labels that are not list in the by clause\n1   [without|by ()] ([parameter,] )   1  ([parameter,] ) [without|by ()]   4.2 functions  abs(): absolute value absent(): ceil(): rounds the sample values of all elements in v up to the nearest integer. changes() :For each input time series, changes(v range-vector) returns the number of times its value has changed within the provided time range as an instant vector. clamp_max(): clamps the sample values of all elements in v to have an upper limit of max. clamp_min(): clamps the sample values of all elements in v to have a lower limit of min. day_of_month(): returns the day of the month for each of the given times in UTC. Returned values are from 1 to 31. day_of_week(): returns the day of the week for each of the given times in UTC. Returned values are from 0 to 6, where 0 means Sunday etc. day_in_month(): returns number of days in the month for each of the given times in UTC. Returned values are from 28 to 31. delta(): deriv(): calculates the per-second derivative of the time series in a range vector v, using simple linear regression. exp(): calculates the exponential function for all elements in v floor(): rounds the sample values of all elements in v down to the nearest integer. histogram_quantile(): calculates the φ-quantile (0 ≤ φ ≤ 1) from the buckets b of a histogram. holt_winters(): hour(): returns the hour of the day for each of the given times in UTC. Returned values are from 0 to 23. idelta(): calculates the difference between the last two samples in the range vector v, returning an instant vector with the given deltas and equivalent labels. increase(): calculates the increase in the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for irate(): calculates the per-second instant rate of increase of the time series in the range vector. label_join(): label_replace(): ln(): calculates the natural logarithm for all elements in v log2(): calculates the binary logarithm for all elements in v log10(): calculates the decimal logarithm for all elements in v minute(): returns the minute of the hour for each of the given times in UTC. Returned values are from 0 to 59. month(): returns the month of the year for each of the given times in UTC. Returned values are from 1 to 12, where 1 means January etc. predict_linear(): predicts the value of time series t seconds from now, based on the range vector v, using simple linear regression. rate(): calculates the per-second average rate of increase of the time series in the range vector. resets(): returns the number of counter resets within the provided time range as an instant vector. round(): rounds the sample values of all elements in v to the nearest integer scalar(): returns the sample value of that single element as a scalar. sort(): returns vector elements sorted by their sample values, in ascending order. sort_desc(): sqrt(): calculates the square root of all elements in v. time(): returns the number of seconds since January 1, 1970 UTC. Note that this does not actually return the current time, but the time at which the expression is to be evaluated. timestamp(): returns the timestamp of each of the samples of the given vector as the number of seconds since January 1, 1970 UTC. vector(): returns the scalar s as a vector with no labels. year(): returns the year for each of the given times in UTC. _over_time():  4.3 demos 1 2 3 4 5 6 7 8 9 10 11  http_requests_total http_requests_total{job=\"apiserver\",handler=\"/api/comments\"} http_requests_total{job=\"apiserver\",handler=\"/api/comments\"}[5m] http_request_total{job=~\".*server\"} http_request_total{status!~\"4..\"} rate(http_request_total[5m])[30m:1m] max_over_time(deriv(rate(distance_covered_total[5s])[30s:5s])[10m:]) rate(http_request_total[5m]) sum by(job)(rate(http_request_total[5m])) topk(3,sum by(app,proc)(rate(instance_cpu_time_ns[5m]))) count by (app) (instance_cpu_time_ns)   4.4 http api expression queries\n1 2 3 4 5 6  GET /api/v1/query POST /api/v1/query query= prometheus exporession query string time= evaluation timestamp timeout= timeout   range query\n1 2 3 4 5 6 7 8  GET /api/v1/query_range POST /api/v1/query_range query= prometheus expression query string start= start end= end step= step timeout= timeout   metadata\n1 2 3 4 5 6  GET /api/v1/series POST /api/v1/series match[]=: Repeated series selector argument that selects the series to return. At least one match[] argument must be provided. start=: Start timestamp. end=: End timestamp.   label names\n1 2 3 4 5  GET /api/v1/labels POST /api/v1/labels start end   label values\n1 2 3  GET /api/v1/label//values start end   targets\n1  GET /api/v1/targets   rules\n1 2  GET /api/v1/rules type: alert/record   alerts\n1  GET /api/v1/alerts   target metadata\n1 2 3 4  GET /api/v1/targets/metadata match_target=: metric= limit=   metric metadata\n1 2 3  GET /api/v1/metadata limit= metric=   alertmanagers\n1  GET /api/v1/alertmanagers   config\n1  GET /api/v1/status/config   runtime information\n1  GET /api/v1/status/runtimeinfo   build information\n1  GET /api/v1/status/buildinfo   over\n","wordCount":"1899","inLanguage":"cn","datePublished":"2021-12-05T11:30:03Z","dateModified":"2021-12-05T11:30:03Z","author":{"@type":"Person","name":"cui"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://eiyouhe.com/posts/prometheus/prometheus-rules/"},"publisher":{"@type":"Organization","name":"神奇宝贝大师的旅行日记","logo":{"@type":"ImageObject","url":"https://eiyouhe.com/images/favicon.png"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://eiyouhe.com accesskey=h title="  (Alt + H)">
<img src=/images/favicon.png alt=logo aria-label=logo height=35> </a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://eiyouhe.com/posts title=列表>
<span>列表</span>
</a>
</li>
<li>
<a href=https://eiyouhe.com/categories title=分类>
<span>分类</span>
</a>
</li>
<li>
<a href=https://eiyouhe.com/tags title=标签>
<span>标签</span>
</a>
</li>
<li>
<a href=https://eiyouhe.com/series title=系列>
<span>系列</span>
</a>
</li>
<li>
<a href=https://eiyouhe.com/archives title=归档>
<span>归档</span>
</a>
</li>
<li>
<a href=https://eiyouhe.com/resume title=冠军>
<span>冠军</span>
</a>
</li>
<li>
<a href=https://eiyouhe.com/psyduck title=救助可达鸭>
<span>救助可达鸭</span>
</a>
</li>
<li>
<a href=https://zukan.pokemon.co.jp/ title=已抓住图鉴>
<span>已抓住图鉴</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://eiyouhe.com>Home</a>&nbsp;»&nbsp;<a href=https://eiyouhe.com/posts/>Posts</a></div>
<h1 class=post-title>
Prometheus Rules
</h1>
<div class=post-description>
Desc Text.
</div>
<div class=post-meta><span title="2021-12-05 11:30:03 +0000 UTC">December 5, 2021</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;cui&nbsp;|&nbsp;<a href=https://github.com/devcui/devcui.github.io/tree/master/content//posts/prometheus/prometheus-rules.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#1two-types-of-rules aria-label="1.Two types of rules">1.Two types of rules</a></li>
<li>
<a href=#2recording-rules aria-label="2.Recording rules">2.Recording rules</a></li>
<li>
<a href=#3alerting-rules aria-label="3.Alerting rules">3.Alerting rules</a></li>
<li>
<a href=#31-template aria-label="3.1 Template">3.1 Template</a><ul>
<li>
<a href=#311-template-examples aria-label="3.1.1 Template examples">3.1.1 Template examples</a></li>
<li>
<a href=#312-template-reference aria-label="3.1.2 Template reference">3.1.2 Template reference</a><ul>
<li>
<a href=#queries aria-label=Queries>Queries</a></li>
<li>
<a href=#numbers aria-label=Numbers>Numbers</a></li>
<li>
<a href=#strings aria-label=Strings>Strings</a></li>
<li>
<a href=#others aria-label=Others>Others</a></li></ul>
</li></ul>
</li>
<li>
<a href=#4promeql aria-label=4.PromeQL>4.PromeQL</a><ul>
<li>
<a href=#41-operators aria-label="4.1 operators">4.1 operators</a><ul>
<li>
<a href=#complute aria-label=complute>complute</a></li>
<li>
<a href=#compare-binary aria-label="compare binary">compare binary</a></li>
<li>
<a href=#logical-set-binary aria-label="Logical set binary">Logical set binary</a></li>
<li>
<a href=#vector-matching aria-label="Vector Matching">Vector Matching</a></li>
<li>
<a href=#aggreation-operators aria-label="Aggreation operators">Aggreation operators</a></li></ul>
</li>
<li>
<a href=#42-functions aria-label="4.2 functions">4.2 functions</a></li></ul>
</li>
<li>
<a href=#43-demos aria-label="4.3 demos">4.3 demos</a><ul>
<li>
<a href=#44-http-api aria-label="4.4 http api">4.4 http api</a>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h1 id=1two-types-of-rules>1.Two types of rules<a hidden class=anchor aria-hidden=true href=#1two-types-of-rules>#</a></h1>
<p>Prometheus supports two types of rules .whitch may be configured and then evaluated at regular intervals:
<code>Recording rules</code> and <code>Alerting rules</code>.</p>
<h1 id=2recording-rules>2.Recording rules<a hidden class=anchor aria-hidden=true href=#2recording-rules>#</a></h1>
<p>1.Recording rules allow you to <code>precompute</code> <code>frequently needed</code> or <code>computationally expensive</code> expressions and save their result as a new set of time series.</p>
<p>2.Be mutch faster than executing the origin expression every time it&rsquo;s need.</p>
<p>3.Rules within a group run sequentially at a regular interval.</p>
<p>the syntax of a rule file following</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>groups:
  [ - &lt;rule_group&gt; ]
</code></pre></td></tr></table>
</div>
</div><p>the rule group following</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>name: &lt;string&gt;
[ interval: &lt;duration&gt; | default = global.evaluation_interval ]
rules:
  [ - &lt;rule&gt; ... ]
</code></pre></td></tr></table>
</div>
</div><p>the recording rule following</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>record: &lt;string&gt;
expr: &lt;string&gt;
labels:
  [ &lt;labelname&gt;: &lt;labelvalue&gt; ]
</code></pre></td></tr></table>
</div>
</div><p>the alerting rule following</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>alert: &lt;string&gt;
expr: &lt;string&gt;
[ for: &lt;duration&gt; | default = 0s ]
labels:
  [ &lt;labelname&gt;: &lt;tmpl_string&gt; ]
annotations:
  [ &lt;labelname&gt;: &lt;tmpl_string&gt; ]
</code></pre></td></tr></table>
</div>
</div><h1 id=3alerting-rules>3.Alerting rules<a hidden class=anchor aria-hidden=true href=#3alerting-rules>#</a></h1>
<p>1.Alerting rules allow you to define some alert conditions that used Prometheus expression language and to send notifaction about firing alerts to an external service.</p>
<p>an example of alerting config would like this</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>groups:
- name: example
  rules:
  - alert: HighRequestLatency
    expr: job:request_latency_seconds:mean5m{job=&#34;myjob&#34;} &gt; 0.5
    for: 10m
    labels:
      severity: page
    annotations:
      summary: High request latency
</code></pre></td></tr></table>
</div>
</div><p>and a template description and annotation would like this</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>groups:
- name: example
  rules:

  # Alert for any instance that is unreachable for &gt;5 minutes.
  - alert: InstanceDown
    expr: up == 0
    for: 5m
    labels:
      severity: page
    annotations:
      summary: &#34;Instance {{ $labels.instance }} down&#34;
      description: &#34;{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes.&#34;

  # Alert for any instance that has a median request latency &gt;1s.
  - alert: APIHighRequestLatency
    expr: api_http_request_latencies_second{quantile=&#34;0.5&#34;} &gt; 1
    for: 10m
    annotations:
      summary: &#34;High request latency on {{ $labels.instance }}&#34;
      description: &#34;{{ $labels.instance }} has a median request latency above 1s (current value: {{ $value }}s)&#34;
</code></pre></td></tr></table>
</div>
</div><h1 id=31-template>3.1 Template<a hidden class=anchor aria-hidden=true href=#31-template>#</a></h1>
<p>1.Prometheus support templating in annotations and labels of alerts.</p>
<p>2.Some functions such as iterate over data,use conditionals,format data.</p>
<p>3.The prometheus template language is based on the Go Template.</p>
<h2 id=311-template-examples>3.1.1 Template examples<a hidden class=anchor aria-hidden=true href=#311-template-examples>#</a></h2>
<p>Iteration</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>{{ range query &#34;up&#34; }}
  {{ .Labels.instance }} {{ .Value }}
{{ end }}
</code></pre></td></tr></table>
</div>
</div><p>Display one value</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>{{ with query &#34;some_metric{instance=&#39;someinstance&#39;}&#34; }}
  {{ . | first | value | humanize }}
{{ end }}
</code></pre></td></tr></table>
</div>
</div><p>Use console url param</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>{{ with printf &#34;node_memory_MemTotal{job=&#39;node&#39;,instance=&#39;%s&#39;}&#34; .Params.instance | query }}
  {{ . | first | value | humanize1024 }}B
{{ end }}
</code></pre></td></tr></table>
</div>
</div><p>That&rsquo;s the meaning of: <code>http://xxx.html?instance=127.0.0.1</code> then the <code>.Params.instance</code> will evaluate to <code>127.0.0.1</code></p>
<p>Advanced iteration</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>&lt;table&gt;
{{ range printf &#34;node_network_receive_bytes{job=&#39;node&#39;,instance=&#39;%s&#39;,device!=&#39;lo&#39;}&#34; .Params.instance | query | sortByLabel &#34;device&#34;}}
  &lt;tr&gt;&lt;th colspan=2&gt;{{ .Labels.device }}&lt;/th&gt;&lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Received&lt;/td&gt;
    &lt;td&gt;{{ with printf &#34;rate(node_network_receive_bytes{job=&#39;node&#39;,instance=&#39;%s&#39;,device=&#39;%s&#39;}[5m])&#34; .Labels.instance .Labels.device | query }}{{ . | first | value | humanize }}B/s{{end}}&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Transmitted&lt;/td&gt;
    &lt;td&gt;{{ with printf &#34;rate(node_network_transmit_bytes{job=&#39;node&#39;,instance=&#39;%s&#39;,device=&#39;%s&#39;}[5m])&#34; .Labels.instance .Labels.device | query }}{{ . | first | value | humanize }}B/s{{end}}&lt;/td&gt;
  &lt;/tr&gt;{{ end }}
&lt;/table&gt;
</code></pre></td></tr></table>
</div>
</div><p>define reusable tempalte</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>{{define &#34;myMultiArgTemplate&#34;}}
  First argument: {{.arg0}}
  Second argument: {{.arg1}}
{{end}}
{{template &#34;myMultiArgTemplate&#34; (args 1 2)}}
</code></pre></td></tr></table>
</div>
</div><h2 id=312-template-reference>3.1.2 Template reference<a hidden class=anchor aria-hidden=true href=#312-template-reference>#</a></h2>
<p>go template <a href=https://golang.org/pkg/text/template/#hdr-Functions>https://golang.org/pkg/text/template/#hdr-Functions</a></p>
<h3 id=queries>Queries<a hidden class=anchor aria-hidden=true href=#queries>#</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Arguments</th>
<th>Returns</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>query string</td>
<td>[]sample</td>
<td>Queries the database, does not support returning range vectors.</td>
</tr>
<tr>
<td>first</td>
<td>[]sample</td>
<td>sample</td>
<td>Equivalent to <code>index a 0</code></td>
</tr>
<tr>
<td>label</td>
<td>label, sample</td>
<td>string</td>
<td>Equivalent to <code>index sample.Labels label</code></td>
</tr>
<tr>
<td>value</td>
<td>sample</td>
<td>float64</td>
<td>Equivalent to <code>sample.Value</code></td>
</tr>
<tr>
<td>sortByLabel</td>
<td>label, []samples</td>
<td>[]sample</td>
<td>Sorts the samples by the given label. Is stable.</td>
</tr>
</tbody>
</table>
<p><code>first</code>, <code>label</code> and <code>value</code> are intended to make query results easily usable in pipelines.</p>
<h3 id=numbers>Numbers<a hidden class=anchor aria-hidden=true href=#numbers>#</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Arguments</th>
<th>Returns</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>humanize</td>
<td>number</td>
<td>string</td>
<td>Converts a number to a more readable format, using <a href=https://en.wikipedia.org/wiki/Metric_prefix>metric prefixes</a>.</td>
</tr>
<tr>
<td>humanize1024</td>
<td>number</td>
<td>string</td>
<td>Like <code>humanize</code>, but uses 1024 as the base rather than 1000.</td>
</tr>
<tr>
<td>humanizeDuration</td>
<td>number</td>
<td>string</td>
<td>Converts a duration in seconds to a more readable format.</td>
</tr>
<tr>
<td>humanizePercentage</td>
<td>number</td>
<td>string</td>
<td>Converts a ratio value to a fraction of 100.</td>
</tr>
<tr>
<td>humanizeTimestamp</td>
<td>number</td>
<td>string</td>
<td>Converts a Unix timestamp in seconds to a more readable format.</td>
</tr>
</tbody>
</table>
<p>Humanizing functions are intended to produce reasonable output for consumption by humans, and are not guaranteed to return the same results between Prometheus versions.</p>
<h3 id=strings>Strings<a hidden class=anchor aria-hidden=true href=#strings>#</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Arguments</th>
<th>Returns</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>title</td>
<td>string</td>
<td>string</td>
<td><a href=https://golang.org/pkg/strings/#Title>strings.Title</a>, capitalises first character of each word.</td>
</tr>
<tr>
<td>toUpper</td>
<td>string</td>
<td>string</td>
<td><a href=https://golang.org/pkg/strings/#ToUpper>strings.ToUpper</a>, converts all characters to upper case.</td>
</tr>
<tr>
<td>toLower</td>
<td>string</td>
<td>string</td>
<td><a href=https://golang.org/pkg/strings/#ToLower>strings.ToLower</a>, converts all characters to lower case.</td>
</tr>
<tr>
<td>match</td>
<td>pattern, text</td>
<td>boolean</td>
<td><a href=https://golang.org/pkg/regexp/#MatchString>regexp.MatchString</a> Tests for a unanchored regexp match.</td>
</tr>
<tr>
<td>reReplaceAll</td>
<td>pattern, replacement, text</td>
<td>string</td>
<td><a href=https://golang.org/pkg/regexp/#Regexp.ReplaceAllString>Regexp.ReplaceAllString</a> Regexp substitution, unanchored.</td>
</tr>
<tr>
<td>graphLink</td>
<td>expr</td>
<td>string</td>
<td>Returns path to graph view in the <a href=https://prometheus.io/docs/visualization/browser/>expression browser</a> for the expression.</td>
</tr>
<tr>
<td>tableLink</td>
<td>expr</td>
<td>string</td>
<td>Returns path to tabular (&ldquo;Table&rdquo;) view in the <a href=https://prometheus.io/docs/visualization/browser/>expression browser</a> for the expression.</td>
</tr>
</tbody>
</table>
<h3 id=others>Others<a hidden class=anchor aria-hidden=true href=#others>#</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Arguments</th>
<th>Returns</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>args</td>
<td>[]interface{}</td>
<td>map[string]interface{}</td>
<td>This converts a list of objects to a map with keys arg0, arg1 etc. This is intended to allow multiple arguments to be passed to templates.</td>
</tr>
<tr>
<td>tmpl</td>
<td>string, []interface{}</td>
<td>nothing</td>
<td>Like the built-in <code>template</code>, but allows non-literals as the template name. Note that the result is assumed to be safe, and will not be auto-escaped. Only available in consoles.</td>
</tr>
<tr>
<td>safeHtml</td>
<td>string</td>
<td>string</td>
<td>Marks string as HTML not requiring auto-escaping.</td>
</tr>
</tbody>
</table>
<h1 id=4promeql>4.PromeQL<a hidden class=anchor aria-hidden=true href=#4promeql>#</a></h1>
<h2 id=41-operators>4.1 operators<a hidden class=anchor aria-hidden=true href=#41-operators>#</a></h2>
<h3 id=complute>complute<a hidden class=anchor aria-hidden=true href=#complute>#</a></h3>
<p><code>+ - * / % ^</code></p>
<h3 id=compare-binary>compare binary<a hidden class=anchor aria-hidden=true href=#compare-binary>#</a></h3>
<p><code> == != >= &lt;= > &lt;</code></p>
<h3 id=logical-set-binary>Logical set binary<a hidden class=anchor aria-hidden=true href=#logical-set-binary>#</a></h3>
<p><code> and , or ,unless</code></p>
<h3 id=vector-matching>Vector Matching<a hidden class=anchor aria-hidden=true href=#vector-matching>#</a></h3>
<p>one to one like this</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>method:http_requests:rate5m{method=&#34;get&#34;}
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) &lt;vector expr&gt;
&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) &lt;vector expr&gt;
</code></pre></td></tr></table>
</div>
</div><p>many to one and one to many like this</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>method_code:http_errors:rate5m / ignoring(code) group_left method:http_requests:rate5m
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;
&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;
&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;
&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;
</code></pre></td></tr></table>
</div>
</div><h3 id=aggreation-operators>Aggreation operators<a hidden class=anchor aria-hidden=true href=#aggreation-operators>#</a></h3>
<ul>
<li><code>sum</code> (calculate sum over dimensions)</li>
<li><code>min</code> (select minimum over dimensions)</li>
<li><code>max</code> (select maximum over dimensions)</li>
<li><code>avg</code> (calculate the average over dimensions)</li>
<li><code>group</code> (all values in the resulting vector are 1)</li>
<li><code>stddev</code> (calculate population standard deviation over dimensions)</li>
<li><code>stdvar</code> (calculate population standard variance over dimensions)</li>
<li><code>count</code> (count number of elements in the vector)</li>
<li><code>count_values</code> (count number of elements with the same value)</li>
<li><code>bottomk</code> (smallest k elements by sample value)</li>
<li><code>topk</code> (largest k elements by sample value)</li>
<li><code>quantile</code> (calculate φ-quantile (0 ≤ φ ≤ 1) over dimensions)</li>
</ul>
<p><code>parameter</code> is only required for <code>count_values</code>, <code>quantile</code>, <code>topk</code> and <code>bottomk</code>.</p>
<p>Without remove the listed labels from the result vector</p>
<p>By does the opposite and drops labels that are not list in the <code>by</code> clause</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>&lt;aggr-op&gt; [without|by (&lt;label list&gt;)] ([parameter,] &lt;vector expression&gt;)
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>&lt;aggr-op&gt;([parameter,] &lt;vector expression&gt;) [without|by (&lt;label list&gt;)]
</code></pre></td></tr></table>
</div>
</div><h2 id=42-functions>4.2 functions<a hidden class=anchor aria-hidden=true href=#42-functions>#</a></h2>
<ul>
<li>abs(): absolute value</li>
<li>absent():</li>
<li>ceil(): rounds the sample values of all elements in <code>v</code> up to the nearest integer.</li>
<li>changes() :For each input time series, <code>changes(v range-vector)</code> returns the number of times its value has changed within the provided time range as an instant vector.</li>
<li>clamp_max(): clamps the sample values of all elements in <code>v</code> to have an upper limit of <code>max</code>.</li>
<li>clamp_min(): clamps the sample values of all elements in <code>v</code> to have a lower limit of <code>min</code>.</li>
<li>day_of_month(): returns the day of the month for each of the given times in UTC. Returned values are from 1 to 31.</li>
<li>day_of_week(): returns the day of the week for each of the given times in UTC. Returned values are from 0 to 6, where 0 means Sunday etc.</li>
<li>day_in_month(): returns number of days in the month for each of the given times in UTC. Returned values are from 28 to 31.</li>
<li>delta():</li>
<li>deriv(): calculates the per-second derivative of the time series in a range vector <code>v</code>, using <a href=https://en.wikipedia.org/wiki/Simple_linear_regression>simple linear regression</a>.</li>
<li>exp(): calculates the exponential function for all elements in <code>v</code></li>
<li>floor(): rounds the sample values of all elements in <code>v</code> down to the nearest integer.</li>
<li>histogram_quantile(): calculates the φ-quantile (0 ≤ φ ≤ 1) from the buckets <code>b</code> of a <a href=https://prometheus.io/docs/concepts/metric_types/#histogram>histogram</a>.</li>
<li>holt_winters():</li>
<li>hour(): returns the hour of the day for each of the given times in UTC. Returned values are from 0 to 23.</li>
<li>idelta(): calculates the difference between the last two samples in the range vector <code>v</code>, returning an instant vector with the given deltas and equivalent labels.</li>
<li>increase(): calculates the increase in the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for</li>
<li>irate(): calculates the per-second instant rate of increase of the time series in the range vector.</li>
<li>label_join():</li>
<li>label_replace():</li>
<li>ln(): calculates the natural logarithm for all elements in <code>v</code></li>
<li>log2(): calculates the binary logarithm for all elements in <code>v</code></li>
<li>log10(): calculates the decimal logarithm for all elements in <code>v</code></li>
<li>minute(): returns the minute of the hour for each of the given times in UTC. Returned values are from 0 to 59.</li>
<li>month(): returns the month of the year for each of the given times in UTC. Returned values are from 1 to 12, where 1 means January etc.</li>
<li>predict_linear(): predicts the value of time series <code>t</code> seconds from now, based on the range vector <code>v</code>, using <a href=https://en.wikipedia.org/wiki/Simple_linear_regression>simple linear regression</a>.</li>
<li>rate(): calculates the per-second average rate of increase of the time series in the range vector.</li>
<li>resets(): returns the number of counter resets within the provided time range as an instant vector.</li>
<li>round(): rounds the sample values of all elements in <code>v</code> to the nearest integer</li>
<li>scalar(): returns the sample value of that single element as a scalar.</li>
<li>sort(): returns vector elements sorted by their sample values, in ascending order.</li>
<li>sort_desc():</li>
<li>sqrt(): calculates the square root of all elements in <code>v</code>.</li>
<li>time(): returns the number of seconds since January 1, 1970 UTC. Note that this does not actually return the current time, but the time at which the expression is to be evaluated.</li>
<li>timestamp(): returns the timestamp of each of the samples of the given vector as the number of seconds since January 1, 1970 UTC.</li>
<li>vector(): returns the scalar <code>s</code> as a vector with no labels.</li>
<li>year(): returns the year for each of the given times in UTC.</li>
<li><code>&lt;aggregation>_over_time()</code>:</li>
</ul>
<h1 id=43-demos>4.3 demos<a hidden class=anchor aria-hidden=true href=#43-demos>#</a></h1>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>http_requests_total
http_requests_total{job=&#34;apiserver&#34;,handler=&#34;/api/comments&#34;}
http_requests_total{job=&#34;apiserver&#34;,handler=&#34;/api/comments&#34;}[5m]
http_request_total{job=~&#34;.*server&#34;}
http_request_total{status!~&#34;4..&#34;}
rate(http_request_total[5m])[30m:1m]
max_over_time(deriv(rate(distance_covered_total[5s])[30s:5s])[10m:])
rate(http_request_total[5m])
sum by(job)(rate(http_request_total[5m]))
topk(3,sum by(app,proc)(rate(instance_cpu_time_ns[5m])))
count by (app) (instance_cpu_time_ns)
</code></pre></td></tr></table>
</div>
</div><h2 id=44-http-api>4.4 http api<a hidden class=anchor aria-hidden=true href=#44-http-api>#</a></h2>
<p>expression queries</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/query
POST /api/v1/query

query=&lt;string&gt; prometheus exporession query string
time=&lt;timestamp&gt; evaluation timestamp
timeout=&lt;duration&gt; timeout
</code></pre></td></tr></table>
</div>
</div><p>range query</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/query_range
POST /api/v1/query_range

query=&lt;string&gt; prometheus expression query string
start=&lt;timestamp&gt; start 
end=&lt;timestamp&gt; end
step=&lt;float&gt; step
timeout=&lt;duration&gt; timeout
</code></pre></td></tr></table>
</div>
</div><p>metadata</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/series
POST /api/v1/series

match[]=&lt;series_selector&gt;: Repeated series selector argument that selects the series to return. At least one match[] argument must be provided.  
start=&lt;rfc3339 | unix_timestamp&gt;: Start timestamp.  
end=&lt;rfc3339 | unix_timestamp&gt;: End timestamp.
</code></pre></td></tr></table>
</div>
</div><p>label names</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/labels
POST /api/v1/labels

start&lt;timestamp&gt;
end&lt;timestamp&gt;
</code></pre></td></tr></table>
</div>
</div><p>label values</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/label/&lt;label_name&gt;/values
start
end
</code></pre></td></tr></table>
</div>
</div><p>targets</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/targets
</code></pre></td></tr></table>
</div>
</div><p>rules</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/rules
type: alert/record
</code></pre></td></tr></table>
</div>
</div><p>alerts</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/alerts
</code></pre></td></tr></table>
</div>
</div><p>target metadata</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/targets/metadata
match_target=&lt;label_selectors&gt;:
metric=&lt;string&gt;
limit=&lt;number&gt;
</code></pre></td></tr></table>
</div>
</div><p>metric metadata</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/metadata
limit=&lt;number&gt;
metric=&lt;string&gt;
</code></pre></td></tr></table>
</div>
</div><p>alertmanagers</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/alertmanagers
</code></pre></td></tr></table>
</div>
</div><p>config</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/status/config
</code></pre></td></tr></table>
</div>
</div><p>runtime information</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/status/runtimeinfo
</code></pre></td></tr></table>
</div>
</div><p>build information</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>GET /api/v1/status/buildinfo
</code></pre></td></tr></table>
</div>
</div><p>over</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://eiyouhe.com/tags/prometheus/>prometheus</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://eiyouhe.com/posts/prometheus/prometheus-alerting/>
<span class=title>« </span>
<br>
<span>Prometheus Alerting</span>
</a>
<a class=next href=https://eiyouhe.com/posts/prometheus/prometheus-redis/>
<span class=title> »</span>
<br>
<span>Prometheus Redis</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://eiyouhe.com>神奇宝贝大师的旅行日记</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>